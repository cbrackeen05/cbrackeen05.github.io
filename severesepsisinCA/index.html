<html>
<script src="https://d3js.org/d3.v7.min.js"></script>

<head>
<title>Severe Sepsis in California</title>
</head>
<style>
.button {
  border: none;
  color: white;
  padding: 12px 20px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 12px;
  margin: 0px;
  float: left;
  transition-duration: 0.4s;
  cursor: pointer;
}

.button1:hover {
  background-color: white; 
  color: black; 
  border: 2px solid #4CAF50;
}

.button1 {
  background-color: #4CAF50;
  color: white;
  border: 2px solid #4CAF50;
}

.button2:hover {
  background-color: white; 
  color: black; 
  border: 2px solid #008CBA;
}

.button2 {
  background-color: #008CBA;
  color: white;
  border: 2px solid #008CBA;
}
div.tooltip {
  position: absolute;
  text-align: center;
  width: 60px;
  height: 28px;
  padding: 2px;
  font: 12px sans-serif;
  background: lightsteelblue;
  border: 0px;
  border-radius: 8px;
  pointer-events: none;
}
</style>
<div style="position:absolute; left:80px; top:2px;">
<h1>Severe Sepsis Cases in California</h1>
  <h4> Severe sepsis is a constant threat in hospitals as
  it is has the number one cost of hospitalization in<br>
  the United States an on average 30% of patients 
  diagnosed with the disease do not survive.</h4>
<button type="button" class="button button2" id="startButton">Start</button>
<button type="button" class="button button1" id="pageOneButton">1</button>
<button type="button" class="button button1" id="pageTwoButton">2</button>
<button type="button" class="button button1">3</button>
</div>
<div style="position:absolute; left:80px; top:190px;">
<svg id='infopara'>
</svg>
</div>
<div style="position:absolute; left:240px; top:140px;">
<svg id='mainbody' width=1100 height=1000>
</svg>
</div>

<body onload='init()'>


  
<script>
async function init() {
var data = await d3.csv("https://raw.githubusercontent.com/cbrackeen05/cbrackeen05.github.io/main/severesepsisinCA/ca_severesep.csv");

var y_cases = d3.scaleLinear().domain([100000,300000]).range([500,0])
var x_year = d3.scaleLinear().domain([2010,2019]).range([0,700])
var y_mort = d3.scaleLinear().domain([0.10,0.30]).range([500,0])
var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

var caseLine = d3
.select('#mainbody')
.append('g').attr('transform','translate(200,10)')
.append('path').datum(data)
.attr("fill","none")
.attr("stroke","none")
.attr("stroke-width", 1.5)
.attr("d", d3.line()
   .x(function(d){return x_year(d.Year);})
   .y(function(d){return y_cases(d.SS_Cases);})
  );
  
var mortLine = d3
.select('#mainbody')
.append('g').attr('transform','translate(200,10)')
.append('path').datum(data)
.attr("fill","none")
.attr("stroke","none")
.attr("stroke-width", 1.5)
.attr("d", d3.line()
   .x(function(d){return x_year(d.Year);})
   .y(function(d){return y_mort(d.SS_Mortality);})
  );
  
var mortDots = d3
.select('#mainbody')
.append('g').attr('transform','translate(200,10)')
.selectAll('circle').data(data).enter().append('circle')
.attr("cx",function(d){return x_year(d.Year);})
.attr("cy",function(d){return y_mort(d.SS_Mortality);})
.attr("r",2)
.attr("fill","none")
.attr("stroke","none");
  
var caseDots = d3
.select('#mainbody')
.append('g').attr('transform','translate(200,10)')
.selectAll('circle').data(data).enter().append('circle')
.attr("cx",function(d){return x_year(d.Year);})
.attr("cy",function(d){return y_cases(d.SS_Cases);})
.attr("r",2)
.attr("fill","none")
.attr("stroke","none");
  
var yAxisCases = d3
.select('#mainbody')
.append('g').attr('transform','translate(200,10)')
.call(d3.axisLeft(y_cases))
.attr("font-size",12)
  
var yAxisMort = d3
.select('#mainbody')
.append('g').attr('transform','translate(900,10)')
.call(d3.axisRight(y_mort))
.attr("font-size",12)

function _addToolTips(){
caseDots
  .on("mouseover", function(event,d) {
    if(d.Year<=2010){
        caseDots.selectAll('circle')
        .filter(d.Year=2010)
        .transition()
        .duration(200)
        .attr("r",10)
       tooltip.transition()
         .duration(200)
         .style("opacity", .9);
       tooltip.html("2010 Case Tooltip")
         .style("left", (event.pageX) + "px")
         .style("top", (event.pageY - 28) + "px");}
      else if(d.Year<=2011){
       tooltip.transition()
         .duration(200)
         .style("opacity", .9);
       tooltip.html("2011 Case Tooltip")
         .style("left", (event.pageX) + "px")
         .style("top", (event.pageY - 28) + "px");}
      else{
       tooltip.transition()
         .duration(200)
         .style("opacity", .9);
       tooltip.html("Case Tooltip")
         .style("left", (event.pageX) + "px")
         .style("top", (event.pageY - 28) + "px");}
       })
   .on("mouseout", function(d) {
       tooltip.transition()
         .duration(500)
         .style("opacity", 0);
       });
}


function _removeCaseAxis(){
 yAxisCases.selectAll('g')
 .transition()
 .attr("opacity",0)
}

function _removeMortAxis(){
 yAxisMort.selectAll('g')
 .transition()
 .attr("opacity",0)
}
_removeCaseAxis()
_removeMortAxis()
  
function _addCaseAxis(){
 yAxisCases.selectAll('g')
 .transition()
 .attr("opacity",1)
}
  
function _addMortAxis(){
 yAxisMort.selectAll('g')
 .transition()
 .attr("opacity",1)
}

function _removeCases(){
caseDots
.transition().duration(1000)
.attr("fill","none")
.attr("stroke","none")
      
caseLine
.transition().duration(1000)
.attr("stroke","none")
  
_removeCaseAxis()
}
 
function _removeMort(){
mortDots
.transition().duration(1000)
.attr("fill","none")
.attr("stroke","none")
      
mortLine
.transition().duration(1000)
.attr("stroke","none")
  
_removeMortAxis()
}
  
function _deleteCasePara(){
d3.select('#casePara1').remove()
}
function _deleteMortPara(){
d3.select('#mortPara1').remove()
}
function _deleteBothPara(){
d3.select('#bothPara1').remove()
d3.select('#bothPara2').remove()
}

function _writeCasePara(){
_deleteBothPara()
_deleteMortPara()
  
d3.select("#infoPara")
.append('text')
.append('tspan')
.attr('id','casePara1')
.attr("y",20)
.text('This is information about Cases.')
}

function _writeMortPara(){
_deleteCasePara()
_deleteBothPara()
  
d3.select("#infoPara")
.append('text')
.append('tspan')
.attr('id','mortPara1')
.attr("y",20)
.text('This is information about Mortality.')
}
  
function _writeBothPara(){
_deleteCasePara()
_deleteMortPara()

d3.select("#infoPara")
.append('text')
.append("tspan")
.attr('id','bothPara1')
  .attr("y",20)
  .text("Hover over the data points on the graph")

d3.select("#infoPara")
.append('text')
.append("tspan")
.attr('id','bothPara2')
  .attr("y", 36)
  .text("to learn more about sepsis over the years.")
}
  
function _drawCaseLine() {
_addCaseAxis()
var casePathLength = caseLine.node().getTotalLength()
  
caseLine
.attr("stroke-dashoffset", casePathLength)
.attr("stroke-dasharray", casePathLength)
.transition().duration(1500)
.attr("stroke","black")
.attr("stroke-dashoffset", 0)
}

function startSlide(){
_removeCases()
_removeMort()
  
caseDots
.transition()
.attr("fill","lightblue")
.attr("stroke","black");
  
_drawCaseLine();
_writeCasePara();
}

function _drawMortLine() {
_addMortAxis();
var mortPathLength = mortLine.node().getTotalLength();
  
mortLine
.attr("stroke-dashoffset", mortPathLength)
.attr("stroke-dasharray", mortPathLength)
.transition().duration(1500)
.attr("stroke","black")
.attr("stroke-dashoffset", 0)
}

function pageOne(){
_removeCases()
_removeMort()
  
mortDots
.transition()
.attr("fill","lightblue")
.attr("stroke","black");

_drawMortLine();
_writeMortPara();
}
  
function pageTwo(){
caseDots
.transition()
.attr("fill","lightblue")
.attr("stroke","black");
  
_drawCaseLine();
  
mortDots
.transition()
.attr("fill","lightblue")
.attr("stroke","black");

_drawMortLine();
_writeBothPara();
_addToolTips();
}


  
d3.select('#mainbody')
.append('g').attr('transform','translate(200,510)')
.call(d3.axisBottom(x_year))
  
d3.select("#startButton").on("click",startSlide)  
d3.select("#pageOneButton").on("click",pageOne)
d3.select("#pageTwoButton").on("click",pageTwo)

}
</script>
</body>
</html>
